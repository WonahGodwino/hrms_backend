"use strict";(()=>{var r={};r.id=255,r.ids=[255],r.modules={53524:r=>{r.exports=require("@prisma/client")},20399:r=>{r.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:r=>{r.exports=require("buffer")},84770:r=>{r.exports=require("crypto")},76162:r=>{r.exports=require("stream")},21764:r=>{r.exports=require("util")},61574:r=>{r.exports=import("@prisma/adapter-pg")},8678:r=>{r.exports=import("pg")},3637:(r,e,t)=>{t.a(r,async(r,s)=>{try{t.r(e),t.d(e,{originalPathname:()=>h,patchFetch:()=>p,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>l});var o=t(49303),a=t(88716),i=t(60670),n=t(31146),u=r([n]);n=(u.then?(await u)():u)[0];let c=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/profile/payslips/route",pathname:"/api/profile/payslips",filename:"route",bundlePath:"app/api/profile/payslips/route"},resolvedPagePath:"C:\\hrms-project\\src\\app\\api\\profile\\payslips\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:f}=c,h="/api/profile/payslips/route";function p(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:l})}s()}catch(r){s(r)}})},31146:(r,e,t)=>{t.a(r,async(r,s)=>{try{t.r(e),t.d(e,{GET:()=>u});var o=t(52850),a=t(92606),i=t(7371),n=r([o]);async function u(r){try{let e=r.headers.get("authorization");if(!e)return i.Rf.error("Authorization header missing",401);let t=e.replace("Bearer ",""),s=(0,a.mk)(t);if(!s.companyId)return i.Rf.error("Company context missing for current user",400);let n=s.companyId,u=await o._.staffRecord.findFirst({where:{id:s.userId,companyId:n}});if(!u)return i.Rf.error("Staff record not found for current user",404);let p=(await o._.payslip.findMany({where:{staffRecordId:u.id,companyId:n},orderBy:[{year:"desc"},{month:"desc"},{createdAt:"desc"}]})).map(r=>({id:r.id,month:r.month,year:r.year,grossPay:r.grossPay?r.grossPay.toString():null,netPay:r.netPay?r.netPay.toString():null,createdAt:r.createdAt,fileName:r.fileName,downloadUrl:`/api/payslips/${r.id}/download`}));return i.Rf.success({staffId:u.staffId,email:u.email,payslips:p},"Payslip history fetched successfully")}catch(r){return(0,i.zG)(r)}}o=(n.then?(await n)():n)[0],s()}catch(r){s(r)}})},92606:(r,e,t)=>{t.d(e,{MH:()=>p,fT:()=>i,mk:()=>u});var s=t(41482),o=t.n(s);function a(){let r=process.env.JWT_SECRET;if(!r)throw Error("JWT_SECRET environment variable is not set");return r}function i(r,e="7d"){return o().sign(r,a(),{expiresIn:e})}t(42023);let n=r=>{try{return o().verify(r,a())}catch{return null}},u=r=>{if(!r)throw Error("Authentication required");let e=n(r);if(!e)throw Error("Invalid or expired token");return e},p=(r,e)=>{let t=u(r);if(!e.includes(t.role))throw Error("Insufficient permissions");return t}},52850:(r,e,t)=>{t.a(r,async(r,s)=>{try{t.d(e,{_:()=>d});var o=t(53524),a=t(61574),i=t(8678),n=r([a,i]);[a,i]=n.then?(await n)():n;let u=globalThis,p=u.pool??new i.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}}),c=new a.PrismaPg(p),d=u.prisma??new o.PrismaClient({adapter:c,log:["query","error","warn"]});s()}catch(r){s(r)}})},7371:(r,e,t)=>{t.d(e,{Rf:()=>o,zG:()=>a});var s=t(87070);class o{static success(r,e="Success",t=200){return s.NextResponse.json({success:!0,message:e,data:r},{status:t})}static error(r="Error",e=400,t){return s.NextResponse.json({success:!1,message:r,errors:t||[]},{status:e})}static unauthorized(r="Unauthorized"){return this.error(r,401)}static forbidden(r="Forbidden"){return this.error(r,403)}static notFound(r="Resource not found"){return this.error(r,404)}static serverError(r="Internal server error"){return this.error(r,500)}}let a=r=>(console.error("API Error:",r),r instanceof Error)?o.error(r.message):o.serverError()}};var e=require("../../../../webpack-runtime.js");e.C(r);var t=r=>e(e.s=r),s=e.X(0,[377,443,70],()=>t(3637));module.exports=s})();