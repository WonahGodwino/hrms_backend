"use strict";(()=>{var e={};e.id=106,e.ids=[106],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},96076:e=>{e.exports=require("rimraf")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},9714:e=>{e.exports=require("constants")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},61574:e=>{e.exports=import("@prisma/adapter-pg")},8678:e=>{e.exports=import("pg")},68957:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>u,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>d,staticGenerationAsyncStorage:()=>f});var i=t(49303),n=t(88716),s=t(60670),a=t(68497),l=e([a]);a=(l.then?(await l)():l)[0];let c=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/jobs/upload/route",pathname:"/api/jobs/upload",filename:"route",bundlePath:"app/api/jobs/upload/route"},resolvedPagePath:"C:\\hrms-project\\src\\app\\api\\jobs\\upload\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:f,serverHooks:d}=c,h="/api/jobs/upload/route";function u(){return(0,s.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:f})}o()}catch(e){o(e)}})},68497:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{OPTIONS:()=>p,POST:()=>f});var i=t(52850),n=t(92606),s=t(7371),a=t(12957),l=t.n(a),u=t(27305),c=e([i]);async function p(e){return(0,u.Ak)(e)}async function f(e){let r=e.headers.get("origin");try{let t=e.headers.get("authorization");if(!t)return(0,u.o3)(s.Rf.error("Authorization header missing",401),r);let o=t.replace("Bearer ",""),a=(0,n.MH)(o,["HR","SUPER_ADMIN"]);if(!a.companyId)return(0,u.o3)(s.Rf.error("Company context missing for this user",400),r);let c=a.companyId,p=(await e.formData()).get("file");if(!p)return(0,u.o3)(s.Rf.error("No file uploaded",400),r);let f=p.name.split(".").pop()?.toLowerCase(),d="csv"===f||"text/csv"===p.type;if(!("xlsx"===f||"xls"===f)&&!d)return(0,u.o3)(s.Rf.error("Invalid file format. Please upload an Excel (.xlsx/.xls) or CSV (.csv) file.",400),r);let h=await p.arrayBuffer(),m=Buffer.from(h),g=[];try{let e=new(l()).Workbook;if(d){let e=m.toString().split(/\r?\n/).filter(e=>e.trim());if(!e.length)throw Error("Empty CSV file");let r=e[0].split(",").map(e=>e.trim());for(let t=1;t<e.length;t++){let o=e[t].trim();if(!o)continue;let i=o.split(",").map(e=>e.trim()),n={};r.forEach((e,r)=>{n[e]=i[r]??""}),g.push(n)}}else{await e.xlsx.load(h);let r=e.worksheets[0];if(!r)throw Error("No worksheet found in Excel file");let t=[];r.getRow(1).eachCell((e,r)=>{t[r-1]=e.value?.toString().trim()||`col${r}`}),r.eachRow((e,r)=>{if(r<=1)return;let o={},i=!1;e.eachCell((e,r)=>{let n=t[r-1],s=e.value;null!=s&&""!==s&&n&&(i=!0),o[n]=s}),i&&g.push(o)})}}catch(e){return(0,u.o3)(s.Rf.error("Failed to parse file. Please check the file format and headers.",400),r)}if(!g.length)return(0,u.o3)(s.Rf.error("No job data found in the file",400),r);let x={totalRows:g.length,successful:0,failed:0,errors:[]};for(let e=0;e<g.length;e++){let r=g[e],t=e+2,o=function(e,r){let t=[],o=r=>{let t=e[r];return null==t?null:"string"==typeof t?t.trim()||null:String(t).trim()||null},i=o("title"),n=o("description"),s=o("department"),a=o("position"),l=e.expirationDate;i||t.push("Missing title"),n||t.push("Missing description"),s||t.push("Missing department"),a||t.push("Missing position");let u=function(e){if(!e)return null;if(e instanceof Date)return isNaN(e.getTime())?null:e;if("string"==typeof e){let r=e.trim();if(!r)return null;let t=new Date(r);return isNaN(t.getTime())?null:t}if("number"==typeof e){let r=new Date(1899,11,30),t=new Date(r.getTime()+864e5*e);return isNaN(t.getTime())?null:t}return null}(l);return(u||t.push("Invalid or missing expirationDate"),t.length>0)?{ok:!1,errors:t}:{ok:!0,data:{title:i,description:n,department:s,position:a,expirationDate:u}}}(r,0);if(!o.ok){x.failed++,x.errors.push(`Row ${t}: ${o.errors.join("; ")}`);continue}let n=o.data;try{await i._.job.create({data:{title:n.title,description:n.description,department:n.department,position:n.position,companyId:c,expirationDate:n.expirationDate,createdBy:a.userId,updatedBy:a.userId}}),x.successful++}catch(r){x.failed++;let e=(0,s.Z)(r);x.errors.push(`Row ${t}: ${e}`)}}return(0,u.o3)(s.Rf.success({summary:{total:x.totalRows,successful:x.successful,failed:x.failed},errors:x.errors},"Job postings uploaded successfully"),r)}catch(t){let e=(0,s.Z)(t);return(0,u.o3)(s.Rf.error(e,500),r)}}i=(c.then?(await c)():c)[0],o()}catch(e){o(e)}})},92606:(e,r,t)=>{t.d(r,{MH:()=>u,fT:()=>s,mk:()=>l});var o=t(41482),i=t.n(o);function n(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET environment variable is not set");return e}function s(e,r="7d"){return i().sign(e,n(),{expiresIn:r})}t(42023);let a=e=>{try{return i().verify(e,n())}catch{return null}},l=e=>{if(!e)throw Error("Authentication required");let r=a(e);if(!r)throw Error("Invalid or expired token");return r},u=(e,r)=>{let t=l(e);if(!r.includes(t.role))throw Error("Insufficient permissions");return t}},27305:(e,r,t)=>{t.d(r,{Ak:()=>s,o3:()=>n});var o=t(87070);let i=["http://localhost:5173","http://localhost:5173"].filter(Boolean);function n(e,r){return Object.entries(function(e){let r=e?i.includes(e)?e:void 0:i[0],t={"Access-Control-Allow-Methods":"GET,POST,PUT,PATCH,DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Access-Control-Allow-Credentials":"true"};return r&&(t["Access-Control-Allow-Origin"]=r),t}(r)).forEach(([r,t])=>{e.headers.set(r,t)}),e}function s(e){let r=e.headers.get("origin");return n(new o.NextResponse(null,{status:200}),r)}},52850:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.d(r,{_:()=>x});var i=t(53524),n=t(61574),s=t(8678),a=t(92048),l=t.n(a),u=t(55315),c=t.n(u),p=e([n,s]);[n,s]=p.then?(await p)():p;let f=globalThis,d=c().join(process.cwd(),"certs","aiven-ca.pem"),h=l().readFileSync(d,"utf8"),m=f.pool??new s.Pool({connectionString:process.env.DATABASE_URL,ssl:{ca:h,rejectUnauthorized:!1}}),g=new n.PrismaPg(m),x=f.prisma??new i.PrismaClient({adapter:g,log:["query","error","warn"]});o()}catch(e){o(e)}})},7371:(e,r,t)=>{t.d(r,{Rf:()=>i,Z:()=>n,zG:()=>s});var o=t(87070);class i{static success(e,r="Success",t=200){return o.NextResponse.json({success:!0,message:r,data:e},{status:t})}static error(e="Error",r=400,t){return o.NextResponse.json({success:!1,message:e,errors:t||[]},{status:r})}static unauthorized(e="Unauthorized"){return this.error(e,401)}static forbidden(e="Forbidden"){return this.error(e,403)}static notFound(e="Resource not found"){return this.error(e,404)}static serverError(e="Internal server error"){return this.error(e,500)}}function n(e){if(e instanceof Error)return e.message;if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return"An unexpected error occurred"}}let s=e=>{console.error("API Error:",e);let r=n(e);return i.error(r,500)}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[377,972,944,957],()=>t(68957));module.exports=o})();