"use strict";(()=>{var r={};r.id=448,r.ids=[448],r.modules={53524:r=>{r.exports=require("@prisma/client")},20399:r=>{r.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:r=>{r.exports=require("buffer")},84770:r=>{r.exports=require("crypto")},20629:r=>{r.exports=require("fs/promises")},55315:r=>{r.exports=require("path")},76162:r=>{r.exports=require("stream")},21764:r=>{r.exports=require("util")},61574:r=>{r.exports=import("@prisma/adapter-pg")},8678:r=>{r.exports=import("pg")},85437:(r,e,t)=>{t.a(r,async(r,o)=>{try{t.r(e),t.d(e,{originalPathname:()=>h,patchFetch:()=>u,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>d});var i=t(49303),n=t(88716),s=t(60670),a=t(92072),p=r([a]);a=(p.then?(await p)():p)[0];let c=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/payslips/[id]/download/route",pathname:"/api/payslips/[id]/download",filename:"route",bundlePath:"app/api/payslips/[id]/download/route"},resolvedPagePath:"C:\\hrms-project\\src\\app\\api\\payslips\\[id]\\download\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:f}=c,h="/api/payslips/[id]/download/route";function u(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:d})}o()}catch(r){o(r)}})},92072:(r,e,t)=>{t.a(r,async(r,o)=>{try{t.r(e),t.d(e,{GET:()=>d});var i=t(52850),n=t(92606),s=t(7371),a=t(20629),p=t.n(a),u=t(55315),c=t.n(u),l=r([i]);async function d(r,{params:e}){try{let t;let o=r.headers.get("authorization");if(!o)return s.Rf.error("Authorization header missing",401);let a=o.replace("Bearer ",""),u=(0,n.MH)(a,["HR","SUPER_ADMIN","STAFF"]);if(!u.companyId)return s.Rf.error("Company context missing for this user",400);let l=u.companyId,{id:d}=e,f=await i._.payslip.findFirst({where:{id:d,companyId:l},include:{staffRecord:!0}});if(!f)return s.Rf.error("Payslip not found",404);if("STAFF"===u.role&&f.staffRecordId!==u.userId)return s.Rf.error("Forbidden",403);let h=f.filePath.startsWith("/")?f.filePath.slice(1):f.filePath,m=c().join(process.cwd(),"public",h);try{t=await p().readFile(m)}catch{return s.Rf.error("Payslip file missing on server",500)}let y=new Uint8Array(t),w=new Blob([y],{type:"application/pdf"});return new Response(w,{headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename="${f.fileName}"`,"Cache-Control":"no-cache"}})}catch(r){return(0,s.zG)(r)}}i=(l.then?(await l)():l)[0],o()}catch(r){o(r)}})},92606:(r,e,t)=>{t.d(e,{MH:()=>u,fT:()=>s,mk:()=>p});var o=t(41482),i=t.n(o);function n(){let r=process.env.JWT_SECRET;if(!r)throw Error("JWT_SECRET environment variable is not set");return r}function s(r,e="7d"){return i().sign(r,n(),{expiresIn:e})}t(42023);let a=r=>{try{return i().verify(r,n())}catch{return null}},p=r=>{if(!r)throw Error("Authentication required");let e=a(r);if(!e)throw Error("Invalid or expired token");return e},u=(r,e)=>{let t=p(r);if(!e.includes(t.role))throw Error("Insufficient permissions");return t}},52850:(r,e,t)=>{t.a(r,async(r,o)=>{try{t.d(e,{_:()=>l});var i=t(53524),n=t(61574),s=t(8678),a=r([n,s]);[n,s]=a.then?(await a)():a;let p=globalThis,u=p.pool??new s.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}}),c=new n.PrismaPg(u),l=p.prisma??new i.PrismaClient({adapter:c,log:["query","error","warn"]});o()}catch(r){o(r)}})},7371:(r,e,t)=>{t.d(e,{Rf:()=>i,zG:()=>n});var o=t(87070);class i{static success(r,e="Success",t=200){return o.NextResponse.json({success:!0,message:e,data:r},{status:t})}static error(r="Error",e=400,t){return o.NextResponse.json({success:!1,message:r,errors:t||[]},{status:e})}static unauthorized(r="Unauthorized"){return this.error(r,401)}static forbidden(r="Forbidden"){return this.error(r,403)}static notFound(r="Resource not found"){return this.error(r,404)}static serverError(r="Internal server error"){return this.error(r,500)}}let n=r=>(console.error("API Error:",r),r instanceof Error)?i.error(r.message):i.serverError()}};var e=require("../../../../../webpack-runtime.js");e.C(r);var t=r=>e(e.s=r),o=e.X(0,[377,443,70],()=>t(85437));module.exports=o})();