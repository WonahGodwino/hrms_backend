"use strict";(()=>{var e={};e.id=2,e.ids=[2],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},61574:e=>{e.exports=import("@prisma/adapter-pg")},8678:e=>{e.exports=import("pg")},56273:(e,r,t)=>{t.a(e,async(e,i)=>{try{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>c,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>p});var s=t(49303),o=t(88716),a=t(60670),n=t(75414),u=e([n]);n=(u.then?(await u)():u)[0];let d=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"C:\\hrms-project\\src\\app\\api\\auth\\register\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:f}=d,m="/api/auth/register/route";function c(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:p})}i()}catch(e){i(e)}})},75414:(e,r,t)=>{t.a(e,async(e,i)=>{try{t.r(r),t.d(r,{OPTIONS:()=>l,POST:()=>p});var s=t(42023),o=t.n(s),a=t(52850),n=t(92606),u=t(7371),c=t(27305),d=e([a]);async function l(e){return(0,c.Ak)(e)}async function p(e){let r=e.headers.get("origin");try{let t;let i=e.headers.get("authorization");if(!i)return(0,c.o3)(u.Rf.error("Authorization header missing",401),r);let s=i.replace("Bearer ",""),d=(0,n.MH)(s,["SUPER_ADMIN"]),{email:l,password:p,firstName:f,lastName:m,role:h="HR",department:g="",position:y="",companyId:w,staffId:A}=await e.json()||{};if(!l||!f||!m)return(0,c.o3)(u.Rf.error("email, firstName, and lastName are required",400),r);if(!p)return(0,c.o3)(u.Rf.error("password is required for admin/HR creation",400),r);let R=w||d.companyId;if(!R)return(0,c.o3)(u.Rf.error("No company assigned for this user",400),r);let v=l.toLowerCase().trim(),x=await a._.staffRecord.findFirst({where:{email:v,companyId:R}}),E=await o().hash(p,10);if(x){if(x.isRegistered&&x.password)return(0,c.o3)(u.Rf.error("User already exists in this company",409),r);t=await a._.staffRecord.update({where:{id:x.id},data:{password:E,isRegistered:!0,isActive:!0,role:h,firstName:f.trim(),lastName:m.trim(),department:g||x.department,position:y||x.position}})}else{let e=A||`ADM-${Date.now().toString(36).toUpperCase()}`;t=await a._.staffRecord.create({data:{staffId:e,email:v,firstName:f.trim(),lastName:m.trim(),department:(g||"Administration").trim(),position:(y||h).trim(),password:E,isRegistered:!0,isActive:!0,role:h,companyId:R,createdBy:d.userId}})}let I=(0,n.fT)({userId:t.id,email:t.email,role:t.role,companyId:t.companyId});return(0,c.o3)(u.Rf.success({token:I,user:{id:t.id,email:t.email,firstName:t.firstName,lastName:t.lastName,role:t.role,companyId:t.companyId,staffId:t.staffId,department:t.department,position:t.position,createdBy:t.createdBy}},"User registered successfully",201),r)}catch(e){return(0,c.o3)((0,u.zG)(e),r)}}a=(d.then?(await d)():d)[0],i()}catch(e){i(e)}})},92606:(e,r,t)=>{t.d(r,{MH:()=>c,fT:()=>a,mk:()=>u});var i=t(41482),s=t.n(i);function o(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET environment variable is not set");return e}function a(e,r="7d"){return s().sign(e,o(),{expiresIn:r})}t(42023);let n=e=>{try{return s().verify(e,o())}catch{return null}},u=e=>{if(!e)throw Error("Authentication required");let r=n(e);if(!r)throw Error("Invalid or expired token");return r},c=(e,r)=>{let t=u(e);if(!r.includes(t.role))throw Error("Insufficient permissions");return t}},27305:(e,r,t)=>{t.d(r,{Ak:()=>a,o3:()=>o});var i=t(87070);let s=["http://localhost:5173","http://localhost:5173"].filter(Boolean);function o(e,r){return Object.entries(function(e){let r=e?s.includes(e)?e:void 0:s[0],t={"Access-Control-Allow-Methods":"GET,POST,PUT,PATCH,DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Access-Control-Allow-Credentials":"true"};return r&&(t["Access-Control-Allow-Origin"]=r),t}(r)).forEach(([r,t])=>{e.headers.set(r,t)}),e}function a(e){let r=e.headers.get("origin");return o(new i.NextResponse(null,{status:200}),r)}},52850:(e,r,t)=>{t.a(e,async(e,i)=>{try{t.d(r,{_:()=>y});var s=t(53524),o=t(61574),a=t(8678),n=t(92048),u=t.n(n),c=t(55315),d=t.n(c),l=e([o,a]);[o,a]=l.then?(await l)():l;let p=globalThis,f=d().join(process.cwd(),"certs","aiven-ca.pem"),m=u().readFileSync(f,"utf8"),h=p.pool??new a.Pool({connectionString:process.env.DATABASE_URL,ssl:{ca:m,rejectUnauthorized:!1}}),g=new o.PrismaPg(h),y=p.prisma??new s.PrismaClient({adapter:g,log:["query","error","warn"]});i()}catch(e){i(e)}})},7371:(e,r,t)=>{t.d(r,{Rf:()=>s,Z:()=>o,zG:()=>a});var i=t(87070);class s{static success(e,r="Success",t=200){return i.NextResponse.json({success:!0,message:r,data:e},{status:t})}static error(e="Error",r=400,t){return i.NextResponse.json({success:!1,message:e,errors:t||[]},{status:r})}static unauthorized(e="Unauthorized"){return this.error(e,401)}static forbidden(e="Forbidden"){return this.error(e,403)}static notFound(e="Resource not found"){return this.error(e,404)}static serverError(e="Internal server error"){return this.error(e,500)}}function o(e){if(e instanceof Error)return e.message;if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return"An unexpected error occurred"}}let a=e=>{console.error("API Error:",e);let r=o(e);return s.error(r,500)}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[377,972,944],()=>t(56273));module.exports=i})();