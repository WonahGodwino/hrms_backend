"use strict";(()=>{var r={};r.id=2,r.ids=[2],r.modules={53524:r=>{r.exports=require("@prisma/client")},20399:r=>{r.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:r=>{r.exports=require("buffer")},84770:r=>{r.exports=require("crypto")},76162:r=>{r.exports=require("stream")},21764:r=>{r.exports=require("util")},61574:r=>{r.exports=import("@prisma/adapter-pg")},8678:r=>{r.exports=import("pg")},56273:(r,e,t)=>{t.a(r,async(r,i)=>{try{t.r(e),t.d(e,{originalPathname:()=>f,patchFetch:()=>d,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var a=t(49303),s=t(88716),o=t(60670),n=t(75414),u=r([n]);n=(u.then?(await u)():u)[0];let c=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"C:\\hrms-project\\src\\app\\api\\auth\\register\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:l,serverHooks:m}=c,f="/api/auth/register/route";function d(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}i()}catch(r){i(r)}})},75414:(r,e,t)=>{t.a(r,async(r,i)=>{try{t.r(e),t.d(e,{POST:()=>c});var a=t(42023),s=t.n(a),o=t(52850),n=t(92606),u=t(7371),d=r([o]);async function c(r){try{let e;let t=r.headers.get("authorization");if(!t)return u.Rf.error("Authorization header missing",401);let i=t.replace("Bearer ",""),a=(0,n.MH)(i,["SUPER_ADMIN"]),{email:d,password:c,firstName:p,lastName:l,role:m="HR",department:f="",position:h="",companyId:g,staffId:w}=await r.json()||{};if(!d||!p||!l)return u.Rf.error("email, firstName, and lastName are required",400);if(!c)return u.Rf.error("password is required for admin/HR creation",400);let y=g||a.companyId;if(!y)return u.Rf.error("No company assigned for this user",400);let R=d.toLowerCase().trim(),v=await o._.staffRecord.findFirst({where:{email:R,companyId:y}}),x=await s().hash(c,10);if(v){if(v.isRegistered&&v.password)return u.Rf.error("User already exists in this company",409);e=await o._.staffRecord.update({where:{id:v.id},data:{password:x,isRegistered:!0,isActive:!0,role:m,firstName:p.trim(),lastName:l.trim(),department:f||v.department,position:h||v.position}})}else{let r=w||`ADM-${Date.now().toString(36).toUpperCase()}`;e=await o._.staffRecord.create({data:{staffId:r,email:R,firstName:p.trim(),lastName:l.trim(),department:(f||"Administration").trim(),position:(h||m).trim(),password:x,isRegistered:!0,isActive:!0,role:m,companyId:y}})}let E=(0,n.fT)({userId:e.id,email:e.email,role:e.role,companyId:e.companyId});return u.Rf.success({token:E,user:{id:e.id,email:e.email,firstName:e.firstName,lastName:e.lastName,role:e.role,companyId:e.companyId,staffId:e.staffId,department:e.department,position:e.position}},"User registered successfully",201)}catch(r){return(0,u.zG)(r)}}o=(d.then?(await d)():d)[0],i()}catch(r){i(r)}})},92606:(r,e,t)=>{t.d(e,{MH:()=>d,fT:()=>o,mk:()=>u});var i=t(41482),a=t.n(i);function s(){let r=process.env.JWT_SECRET;if(!r)throw Error("JWT_SECRET environment variable is not set");return r}function o(r,e="7d"){return a().sign(r,s(),{expiresIn:e})}t(42023);let n=r=>{try{return a().verify(r,s())}catch{return null}},u=r=>{if(!r)throw Error("Authentication required");let e=n(r);if(!e)throw Error("Invalid or expired token");return e},d=(r,e)=>{let t=u(r);if(!e.includes(t.role))throw Error("Insufficient permissions");return t}},52850:(r,e,t)=>{t.a(r,async(r,i)=>{try{t.d(e,{_:()=>p});var a=t(53524),s=t(61574),o=t(8678),n=r([s,o]);[s,o]=n.then?(await n)():n;let u=globalThis,d=u.pool??new o.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}}),c=new s.PrismaPg(d),p=u.prisma??new a.PrismaClient({adapter:c,log:["query","error","warn"]});i()}catch(r){i(r)}})},7371:(r,e,t)=>{t.d(e,{Rf:()=>a,zG:()=>s});var i=t(87070);class a{static success(r,e="Success",t=200){return i.NextResponse.json({success:!0,message:e,data:r},{status:t})}static error(r="Error",e=400,t){return i.NextResponse.json({success:!1,message:r,errors:t||[]},{status:e})}static unauthorized(r="Unauthorized"){return this.error(r,401)}static forbidden(r="Forbidden"){return this.error(r,403)}static notFound(r="Resource not found"){return this.error(r,404)}static serverError(r="Internal server error"){return this.error(r,500)}}let s=r=>(console.error("API Error:",r),r instanceof Error)?a.error(r.message):a.serverError()}};var e=require("../../../../webpack-runtime.js");e.C(r);var t=r=>e(e.s=r),i=e.X(0,[377,443,70],()=>t(56273));module.exports=i})();