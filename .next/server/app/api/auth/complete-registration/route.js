"use strict";(()=>{var e={};e.id=267,e.ids=[267],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},61574:e=>{e.exports=import("@prisma/adapter-pg")},8678:e=>{e.exports=import("pg")},38743:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>u,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var a=t(49303),n=t(88716),i=t(60670),s=t(13792),c=e([s]);s=(c.then?(await c)():c)[0];let p=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/complete-registration/route",pathname:"/api/auth/complete-registration",filename:"route",bundlePath:"app/api/auth/complete-registration/route"},resolvedPagePath:"C:\\hrms-project\\src\\app\\api\\auth\\complete-registration\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:m}=p,f="/api/auth/complete-registration/route";function u(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}o()}catch(e){o(e)}})},13792:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{POST:()=>p});var a=t(42023),n=t.n(a),i=t(52850),s=t(7371),c=t(92606),u=e([i]);async function p(e){try{let{email:r,staffId:t,password:o,companyId:a}=await e.json()||{};if(!r||!t||!o)return s.Rf.error("email, staffId, and password are required",400);let u=r.toLowerCase().trim(),p=t.toString().trim(),d=null;if(a)d=await i._.staffRecord.findUnique({where:{staffId_companyId:{staffId:p,companyId:a.toString()}},include:{company:!0}});else{let e=await i._.staffRecord.findMany({where:{staffId:p},include:{company:!0}});if(0===e.length)return s.Rf.error("Staff record not found. Contact HR.",404);if(e.length>1)return s.Rf.error("This staffId exists in multiple companies. Please include companyId to complete registration.",400);d=e[0]}if(!d)return s.Rf.error("Staff record not found. Contact HR.",404);if(d.email.toLowerCase().trim()!==u)return s.Rf.error("Email does not match staff record",403);if(!d.companyId)return s.Rf.error("Staff has no company assigned. Contact HR.",400);if(d.isRegistered)return s.Rf.error("Registration already completed. Please login.",409);let l=await n().hash(o,10),m=await i._.staffRecord.update({where:{id:d.id},data:{password:l,isRegistered:!0,isActive:!0},include:{company:!0}}),f=(0,c.fT)({userId:m.id,email:m.email,role:m.role||m.position,companyId:m.companyId});return s.Rf.success({token:f,user:{id:m.id,staffId:m.staffId,email:m.email,firstName:m.firstName,lastName:m.lastName,role:m.role||m.position,companyId:m.companyId,department:m.department,position:m.position},company:m.company?{id:m.company.id,companyName:m.company.companyName,email:m.company.email,phone:m.company.phone,address:m.company.address}:null},"Registration completed successfully")}catch(e){return(0,s.zG)(e)}}i=(u.then?(await u)():u)[0],o()}catch(e){o(e)}})},92606:(e,r,t)=>{t.d(r,{MH:()=>u,fT:()=>i,mk:()=>c});var o=t(41482),a=t.n(o);function n(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET environment variable is not set");return e}function i(e,r="7d"){return a().sign(e,n(),{expiresIn:r})}t(42023);let s=e=>{try{return a().verify(e,n())}catch{return null}},c=e=>{if(!e)throw Error("Authentication required");let r=s(e);if(!r)throw Error("Invalid or expired token");return r},u=(e,r)=>{let t=c(e);if(!r.includes(t.role))throw Error("Insufficient permissions");return t}},52850:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.d(r,{_:()=>d});var a=t(53524),n=t(61574),i=t(8678),s=e([n,i]);[n,i]=s.then?(await s)():s;let c=globalThis,u=c.pool??new i.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}}),p=new n.PrismaPg(u),d=c.prisma??new a.PrismaClient({adapter:p,log:["query","error","warn"]});o()}catch(e){o(e)}})},7371:(e,r,t)=>{t.d(r,{Rf:()=>a,zG:()=>n});var o=t(87070);class a{static success(e,r="Success",t=200){return o.NextResponse.json({success:!0,message:r,data:e},{status:t})}static error(e="Error",r=400,t){return o.NextResponse.json({success:!1,message:e,errors:t||[]},{status:r})}static unauthorized(e="Unauthorized"){return this.error(e,401)}static forbidden(e="Forbidden"){return this.error(e,403)}static notFound(e="Resource not found"){return this.error(e,404)}static serverError(e="Internal server error"){return this.error(e,500)}}let n=e=>(console.error("API Error:",e),e instanceof Error)?a.error(e.message):a.serverError()}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[377,443,70],()=>t(38743));module.exports=o})();