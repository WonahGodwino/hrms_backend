"use strict";(()=>{var e={};e.id=267,e.ids=[267],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},61574:e=>{e.exports=import("@prisma/adapter-pg")},8678:e=>{e.exports=import("pg")},38743:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>u,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>f,staticGenerationAsyncStorage:()=>p});var n=t(49303),a=t(88716),i=t(60670),s=t(13792),c=e([s]);s=(c.then?(await c)():c)[0];let l=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/complete-registration/route",pathname:"/api/auth/complete-registration",filename:"route",bundlePath:"app/api/auth/complete-registration/route"},resolvedPagePath:"C:\\hrms-project\\src\\app\\api\\auth\\complete-registration\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:f}=l,m="/api/auth/complete-registration/route";function u(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:p})}o()}catch(e){o(e)}})},13792:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{OPTIONS:()=>d,POST:()=>p});var n=t(42023),a=t.n(n),i=t(52850),s=t(7371),c=t(92606),u=t(27305),l=e([i]);async function d(e){return(0,u.Ak)(e)}async function p(e){let r=e.headers.get("origin");try{let{email:t,staffId:o,password:n,companyId:l}=await e.json()||{};if(!t||!o||!n)return(0,u.o3)(s.Rf.error("email, staffId, and password are required",400),r);let d=t.toLowerCase().trim(),p=o.toString().trim(),f=null;if(l)f=await i._.staffRecord.findUnique({where:{staffId_companyId:{staffId:p,companyId:l.toString()}},include:{company:!0}});else{let e=await i._.staffRecord.findMany({where:{staffId:p},include:{company:!0}});if(0===e.length)return(0,u.o3)(s.Rf.error("Staff record not found. Contact HR.",404),r);if(e.length>1)return(0,u.o3)(s.Rf.error("This staffId exists in multiple companies. Please include companyId to complete registration.",400),r);f=e[0]}if(!f)return(0,u.o3)(s.Rf.error("Staff record not found. Contact HR.",404),r);if(f.email.toLowerCase().trim()!==d)return(0,u.o3)(s.Rf.error("Email does not match staff record",403),r);if(!f.companyId)return(0,u.o3)(s.Rf.error("Staff has no company assigned. Contact HR.",400),r);if(f.isRegistered)return(0,u.o3)(s.Rf.error("Registration already completed. Please login.",409),r);let m=await a().hash(n,10),h=await i._.staffRecord.update({where:{id:f.id},data:{password:m,isRegistered:!0,isActive:!0},include:{company:!0}}),y=(0,c.fT)({userId:h.id,email:h.email,role:h.role||h.position,companyId:h.companyId});return(0,u.o3)(s.Rf.success({token:y,user:{id:h.id,staffId:h.staffId,email:h.email,firstName:h.firstName,lastName:h.lastName,role:h.role||h.position,companyId:h.companyId,department:h.department,position:h.position},company:h.company?{id:h.company.id,companyName:h.company.companyName,email:h.company.email,phone:h.company.phone,address:h.company.address}:null},"Registration completed successfully"),r)}catch(e){return(0,u.o3)((0,s.zG)(e),r)}}i=(l.then?(await l)():l)[0],o()}catch(e){o(e)}})},92606:(e,r,t)=>{t.d(r,{MH:()=>u,fT:()=>i,mk:()=>c});var o=t(41482),n=t.n(o);function a(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET environment variable is not set");return e}function i(e,r="7d"){return n().sign(e,a(),{expiresIn:r})}t(42023);let s=e=>{try{return n().verify(e,a())}catch{return null}},c=e=>{if(!e)throw Error("Authentication required");let r=s(e);if(!r)throw Error("Invalid or expired token");return r},u=(e,r)=>{let t=c(e);if(!r.includes(t.role))throw Error("Insufficient permissions");return t}},27305:(e,r,t)=>{t.d(r,{Ak:()=>i,o3:()=>a});var o=t(87070);let n=["http://localhost:5173","http://localhost:5173"].filter(Boolean);function a(e,r){return Object.entries(function(e){let r=e?n.includes(e)?e:void 0:n[0],t={"Access-Control-Allow-Methods":"GET,POST,PUT,PATCH,DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Access-Control-Allow-Credentials":"true"};return r&&(t["Access-Control-Allow-Origin"]=r),t}(r)).forEach(([r,t])=>{e.headers.set(r,t)}),e}function i(e){let r=e.headers.get("origin");return a(new o.NextResponse(null,{status:200}),r)}},52850:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.d(r,{_:()=>g});var n=t(53524),a=t(61574),i=t(8678),s=t(92048),c=t.n(s),u=t(55315),l=t.n(u),d=e([a,i]);[a,i]=d.then?(await d)():d;let p=globalThis,f=l().join(process.cwd(),"certs","aiven-ca.pem"),m=c().readFileSync(f,"utf8"),h=p.pool??new i.Pool({connectionString:process.env.DATABASE_URL,ssl:{ca:m,rejectUnauthorized:!1}}),y=new a.PrismaPg(h),g=p.prisma??new n.PrismaClient({adapter:y,log:["query","error","warn"]});o()}catch(e){o(e)}})},7371:(e,r,t)=>{t.d(r,{Rf:()=>n,Z:()=>a,zG:()=>i});var o=t(87070);class n{static success(e,r="Success",t=200){return o.NextResponse.json({success:!0,message:r,data:e},{status:t})}static error(e="Error",r=400,t){return o.NextResponse.json({success:!1,message:e,errors:t||[]},{status:r})}static unauthorized(e="Unauthorized"){return this.error(e,401)}static forbidden(e="Forbidden"){return this.error(e,403)}static notFound(e="Resource not found"){return this.error(e,404)}static serverError(e="Internal server error"){return this.error(e,500)}}function a(e){if(e instanceof Error)return e.message;if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return"An unexpected error occurred"}}let i=e=>{console.error("API Error:",e);let r=a(e);return n.error(r,500)}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[377,972,944],()=>t(38743));module.exports=o})();