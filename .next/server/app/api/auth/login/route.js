"use strict";(()=>{var r={};r.id=873,r.ids=[873],r.modules={53524:r=>{r.exports=require("@prisma/client")},20399:r=>{r.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:r=>{r.exports=require("buffer")},84770:r=>{r.exports=require("crypto")},76162:r=>{r.exports=require("stream")},21764:r=>{r.exports=require("util")},61574:r=>{r.exports=import("@prisma/adapter-pg")},8678:r=>{r.exports=import("pg")},59906:(r,e,t)=>{t.a(r,async(r,i)=>{try{t.r(e),t.d(e,{originalPathname:()=>f,patchFetch:()=>c,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var n=t(49303),o=t(88716),a=t(60670),s=t(76344),u=r([s]);s=(u.then?(await u)():u)[0];let l=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\hrms-project\\src\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:m}=l,f="/api/auth/login/route";function c(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}i()}catch(r){i(r)}})},76344:(r,e,t)=>{t.a(r,async(r,i)=>{try{t.r(e),t.d(e,{POST:()=>l});var n=t(42023),o=t.n(n),a=t(52850),s=t(7371),u=t(92606),c=r([a]);async function l(r){try{let{email:e,password:t,companyId:i}=await r.json()||{};if(!e||!t)return s.Rf.error("Email and password are required",400);let n=e.toLowerCase().trim(),c=null;if(i)c=await a._.staffRecord.findUnique({where:{email_companyId:{email:n,companyId:i.toString()}}});else{let r=await a._.staffRecord.findMany({where:{email:n}});if(0===r.length)return s.Rf.error("Invalid credentials",401);if(r.length>1)return s.Rf.error("This email exists in multiple companies. Please include companyId to login.",400);c=r[0]}if(!c)return s.Rf.error("Invalid credentials",401);if(!c.isActive)return s.Rf.error("Account is deactivated",403);if(!c.isRegistered)return s.Rf.error("Complete registration before login",403);if(!c.password)return s.Rf.error("Account is not fully set up. Please complete registration.",400);if(!await o().compare(t,c.password))return s.Rf.error("Invalid credentials",401);let l=(0,u.fT)({userId:c.id,email:c.email,role:c.role,companyId:c.companyId}),d=await a._.company.findUnique({where:{id:c.companyId}});return s.Rf.success({token:l,user:{id:c.id,email:c.email,firstName:c.firstName,lastName:c.lastName,role:c.role,companyId:c.companyId,department:c.department,position:c.position,staffId:c.staffId},company:d?{id:d.id,companyName:d.companyName,email:d.email,phone:d.phone,address:d.address}:null},"Login successful")}catch(r){return(0,s.zG)(r)}}a=(c.then?(await c)():c)[0],i()}catch(r){i(r)}})},92606:(r,e,t)=>{t.d(e,{MH:()=>c,fT:()=>a,mk:()=>u});var i=t(41482),n=t.n(i);function o(){let r=process.env.JWT_SECRET;if(!r)throw Error("JWT_SECRET environment variable is not set");return r}function a(r,e="7d"){return n().sign(r,o(),{expiresIn:e})}t(42023);let s=r=>{try{return n().verify(r,o())}catch{return null}},u=r=>{if(!r)throw Error("Authentication required");let e=s(r);if(!e)throw Error("Invalid or expired token");return e},c=(r,e)=>{let t=u(r);if(!e.includes(t.role))throw Error("Insufficient permissions");return t}},52850:(r,e,t)=>{t.a(r,async(r,i)=>{try{t.d(e,{_:()=>d});var n=t(53524),o=t(61574),a=t(8678),s=r([o,a]);[o,a]=s.then?(await s)():s;let u=globalThis,c=u.pool??new a.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}}),l=new o.PrismaPg(c),d=u.prisma??new n.PrismaClient({adapter:l,log:["query","error","warn"]});i()}catch(r){i(r)}})},7371:(r,e,t)=>{t.d(e,{Rf:()=>n,zG:()=>o});var i=t(87070);class n{static success(r,e="Success",t=200){return i.NextResponse.json({success:!0,message:e,data:r},{status:t})}static error(r="Error",e=400,t){return i.NextResponse.json({success:!1,message:r,errors:t||[]},{status:e})}static unauthorized(r="Unauthorized"){return this.error(r,401)}static forbidden(r="Forbidden"){return this.error(r,403)}static notFound(r="Resource not found"){return this.error(r,404)}static serverError(r="Internal server error"){return this.error(r,500)}}let o=r=>(console.error("API Error:",r),r instanceof Error)?n.error(r.message):n.serverError()}};var e=require("../../../../webpack-runtime.js");e.C(r);var t=r=>e(e.s=r),i=e.X(0,[377,443,70],()=>t(59906));module.exports=i})();