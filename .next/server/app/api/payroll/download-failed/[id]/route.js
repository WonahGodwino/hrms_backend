"use strict";(()=>{var e={};e.id=42,e.ids=[42],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},20629:e=>{e.exports=require("fs/promises")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},61574:e=>{e.exports=import("@prisma/adapter-pg")},8678:e=>{e.exports=import("pg")},10270:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>p,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>c});var n=t(49303),a=t(88716),i=t(60670),s=t(73731),l=e([s]);s=(l.then?(await l)():l)[0];let d=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/payroll/download-failed/[id]/route",pathname:"/api/payroll/download-failed/[id]",filename:"route",bundlePath:"app/api/payroll/download-failed/[id]/route"},resolvedPagePath:"C:\\hrms-project\\src\\app\\api\\payroll\\download-failed\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:u,staticGenerationAsyncStorage:c,serverHooks:f}=d,h="/api/payroll/download-failed/[id]/route";function p(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:c})}o()}catch(e){o(e)}})},49303:(e,r,t)=>{e.exports=t(30517)},73731:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{GET:()=>p});var n=t(52850),a=t(92606),i=t(92048),s=t(20629),l=e([n]);async function p(e,{params:r}){try{let t=e.headers.get("authorization")?.replace("Bearer ","")||null;(0,a.MH)(t,["HR","SUPER_ADMIN"]);let o=r.id;if(!o)return new Response(JSON.stringify({error:"Upload ID is required"}),{status:400,headers:{"Content-Type":"application/json"}});console.log(`Download request for upload ID: ${o}`);let l=await n._.payrollUpload.findUnique({where:{id:o}});if(!l)return new Response(JSON.stringify({error:"Upload record not found"}),{status:404,headers:{"Content-Type":"application/json"}});if(!l.processedFilePath)return new Response(JSON.stringify({error:"No failed records file available for this upload"}),{status:404,headers:{"Content-Type":"application/json"}});try{await (0,s.stat)(l.processedFilePath),console.log(`File found at: ${l.processedFilePath}`)}catch(e){return console.error("File not found:",e),new Response(JSON.stringify({error:"Failed records file not found on server"}),{status:404,headers:{"Content-Type":"application/json"}})}let p=(0,i.createReadStream)(l.processedFilePath),d=`failed-records-${l.fileName||l.id}.xlsx`;return console.log(`Streaming file: ${d}`),new Response(p,{headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-Disposition":`attachment; filename="${d}"`,"Cache-Control":"private, max-age=3600"}})}catch(e){return console.error("Failed records download error:",e),new Response(JSON.stringify({error:"Internal server error"}),{status:500,headers:{"Content-Type":"application/json"}})}}n=(l.then?(await l)():l)[0],o()}catch(e){o(e)}})},92606:(e,r,t)=>{t.d(r,{MH:()=>p,fT:()=>i,mk:()=>l});var o=t(41482),n=t.n(o);function a(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET environment variable is not set");return e}function i(e,r="7d"){return n().sign(e,a(),{expiresIn:r})}t(42023);let s=e=>{try{return n().verify(e,a())}catch{return null}},l=e=>{if(!e)throw Error("Authentication required");let r=s(e);if(!r)throw Error("Invalid or expired token");return r},p=(e,r)=>{let t=l(e);if(!r.includes(t.role))throw Error("Insufficient permissions");return t}},52850:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.d(r,{_:()=>w});var n=t(53524),a=t(61574),i=t(8678),s=t(92048),l=t.n(s),p=t(55315),d=t.n(p),u=e([a,i]);[a,i]=u.then?(await u)():u;let c=globalThis,f=d().join(process.cwd(),"certs","aiven-ca.pem"),h=l().readFileSync(f,"utf8"),m=c.pool??new i.Pool({connectionString:process.env.DATABASE_URL,ssl:{ca:h,rejectUnauthorized:!1}}),y=new a.PrismaPg(m),w=c.prisma??new n.PrismaClient({adapter:y,log:["query","error","warn"]});o()}catch(e){o(e)}})}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[377,944],()=>t(10270));module.exports=o})();