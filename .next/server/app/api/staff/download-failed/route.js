(()=>{var e={};e.id=719,e.ids=[719],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},96076:e=>{"use strict";e.exports=require("rimraf")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},9714:e=>{"use strict";e.exports=require("constants")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},20629:e=>{"use strict";e.exports=require("fs/promises")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},61574:e=>{"use strict";e.exports=import("@prisma/adapter-pg")},8678:e=>{"use strict";e.exports=import("pg")},61184:(e,r,t)=>{"use strict";t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>c,requestAsyncStorage:()=>f,routeModule:()=>l,serverHooks:()=>d,staticGenerationAsyncStorage:()=>p});var s=t(49303),n=t(88716),i=t(60670),a=t(9370),u=e([a]);a=(u.then?(await u)():u)[0];let l=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/staff/download-failed/route",pathname:"/api/staff/download-failed",filename:"route",bundlePath:"app/api/staff/download-failed/route"},resolvedPagePath:"C:\\hrms-project\\src\\app\\api\\staff\\download-failed\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:p,serverHooks:d}=l,h="/api/staff/download-failed/route";function c(){return(0,i.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:p})}o()}catch(e){o(e)}})},21724:e=>{var r=Object.prototype.toString;e.exports=function(e){return!0===e||!1===e||!!e&&"object"==typeof e&&"[object Boolean]"==r.call(e)}},29080:e=>{var r,t,o=Object.prototype,s=Function.prototype.toString,n=o.hasOwnProperty,i=s.call(Object),a=o.toString,u=(r=Object.getPrototypeOf,t=Object,function(e){return r(t(e))});e.exports=function(e){if(!(e&&"object"==typeof e)||"[object Object]"!=a.call(e)||function(e){var r=!1;if(null!=e&&"function"!=typeof e.toString)try{r=!!(e+"")}catch(e){}return r}(e))return!1;var r=u(e);if(null===r)return!0;var t=n.call(r,"constructor")&&r.constructor;return"function"==typeof t&&t instanceof t&&s.call(t)==i}},18243:(e,r,t)=>{var o=t(78893),s=o.Buffer;function n(e,r){for(var t in e)r[t]=e[t]}function i(e,r,t){return s(e,r,t)}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?e.exports=o:(n(o,r),r.Buffer=i),i.prototype=Object.create(s.prototype),n(s,i),i.from=function(e,r,t){if("number"==typeof e)throw TypeError("Argument must not be a number");return s(e,r,t)},i.alloc=function(e,r,t){if("number"!=typeof e)throw TypeError("Argument must be a number");var o=s(e);return void 0!==r?"string"==typeof t?o.fill(r,t):o.fill(r):o.fill(0),o},i.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return s(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return o.SlowBuffer(e)}},9370:(e,r,t)=>{"use strict";t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{GET:()=>h,OPTIONS:()=>d});var s=t(52850),n=t(7371),i=t(12957),a=t.n(i),u=t(27305),c=t(20629),l=t(55315),f=t.n(l),p=e([s]);async function d(e){return(0,u.Ak)(e)}async function h(e){let r=e.headers.get("origin");try{let{searchParams:t}=new URL(e.url),o=t.get("uploadId");if(!o)return(0,u.o3)(n.Rf.error("Upload ID is required",400),r);let i=await s._.staffUpload.findUnique({where:{id:o}});if(!i||0===i.errors.length)return(0,u.o3)(n.Rf.error("No failed records found for this upload",404),r);let l=new(a()).Workbook,p=l.addWorksheet("Failed Staff Records");p.columns=[{header:"Staff ID",key:"staffId",width:20},{header:"Email",key:"email",width:30},{header:"First Name",key:"firstName",width:20},{header:"Last Name",key:"lastName",width:20},{header:"Department",key:"department",width:20},{header:"Position",key:"position",width:20},{header:"Error",key:"error",width:50}],i.errors.forEach(e=>{p.addRow({staffId:e.staffId,email:e.email,firstName:e.firstName,lastName:e.lastName,department:e.department,position:e.position,error:e.error})});let d=await l.xlsx.writeBuffer(),h=f().join(process.cwd(),"uploads","failed_records.xlsx");await (0,c.writeFile)(h,d);let m=new NextResponse(d,{headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-Disposition":'attachment; filename="failed_records.xlsx"',"Cache-Control":"no-cache"}});return(0,u.o3)(m,r)}catch(e){return(0,u.o3)((0,n.zG)(e),r)}}s=(p.then?(await p)():p)[0],o()}catch(e){o(e)}})},27305:(e,r,t)=>{"use strict";t.d(r,{Ak:()=>i,o3:()=>n});var o=t(87070);let s=["http://localhost:5173","http://localhost:5173"].filter(Boolean);function n(e,r){return Object.entries(function(e){let r=e?s.includes(e)?e:void 0:s[0],t={"Access-Control-Allow-Methods":"GET,POST,PUT,PATCH,DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Access-Control-Allow-Credentials":"true"};return r&&(t["Access-Control-Allow-Origin"]=r),t}(r)).forEach(([r,t])=>{e.headers.set(r,t)}),e}function i(e){let r=e.headers.get("origin");return n(new o.NextResponse(null,{status:200}),r)}},52850:(e,r,t)=>{"use strict";t.a(e,async(e,o)=>{try{t.d(r,{_:()=>w});var s=t(53524),n=t(61574),i=t(8678),a=t(92048),u=t.n(a),c=t(55315),l=t.n(c),f=e([n,i]);[n,i]=f.then?(await f)():f;let p=globalThis,d=l().join(process.cwd(),"certs","aiven-ca.pem"),h=u().readFileSync(d,"utf8"),m=p.pool??new i.Pool({connectionString:process.env.DATABASE_URL,ssl:{ca:h,rejectUnauthorized:!1}}),y=new n.PrismaPg(m),w=p.prisma??new s.PrismaClient({adapter:y,log:["query","error","warn"]});o()}catch(e){o(e)}})},7371:(e,r,t)=>{"use strict";t.d(r,{Rf:()=>s,Z:()=>n,zG:()=>i});var o=t(87070);class s{static success(e,r="Success",t=200){return o.NextResponse.json({success:!0,message:r,data:e},{status:t})}static error(e="Error",r=400,t){return o.NextResponse.json({success:!1,message:e,errors:t||[]},{status:r})}static unauthorized(e="Unauthorized"){return this.error(e,401)}static forbidden(e="Forbidden"){return this.error(e,403)}static notFound(e="Resource not found"){return this.error(e,404)}static serverError(e="Internal server error"){return this.error(e,500)}}function n(e){if(e instanceof Error)return e.message;if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return"An unexpected error occurred"}}let i=e=>{console.error("API Error:",e);let r=n(e);return s.error(r,500)}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[377,972,957],()=>t(61184));module.exports=o})();