"use strict";(()=>{var e={};e.id=948,e.ids=[948],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},61574:e=>{e.exports=import("@prisma/adapter-pg")},8678:e=>{e.exports=import("pg")},85059:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>u,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>l});var n=t(49303),o=t(88716),i=t(60670),a=t(10113),c=e([a]);a=(c.then?(await c)():c)[0];let p=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/staff/records/route",pathname:"/api/staff/records",filename:"route",bundlePath:"app/api/staff/records/route"},resolvedPagePath:"C:\\hrms-project\\src\\app\\api\\staff\\records\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:f}=p,m="/api/staff/records/route";function u(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:l})}s()}catch(e){s(e)}})},10113:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{GET:()=>c});var n=t(52850),o=t(92606),i=t(7371),a=e([n]);async function c(e){try{let r=e.headers.get("authorization");if(!r)return i.Rf.error("Authorization header missing",401);let t=r.replace("Bearer ",""),s=(0,o.MH)(t,["HR","SUPER_ADMIN","MANAGER"]),{searchParams:a}=new URL(e.url),c=parseInt(a.get("page")||"1",10),u=parseInt(a.get("limit")||"50",10),p=a.get("department"),d=a.get("search"),l=(c-1)*u,f={companyId:s.companyId};p&&(f.department={contains:p,mode:"insensitive"}),d&&(f.OR=[{firstName:{contains:d,mode:"insensitive"}},{lastName:{contains:d,mode:"insensitive"}},{staffId:{contains:d,mode:"insensitive"}},{email:{contains:d,mode:"insensitive"}}]);let[m,h]=await Promise.all([n._.staffRecord.findMany({where:f,skip:l,take:u,orderBy:{createdAt:"desc"},select:{id:!0,staffId:!0,email:!0,firstName:!0,lastName:!0,department:!0,position:!0,phone:!0,isActive:!0,createdAt:!0}}),n._.staffRecord.count({where:f})]);return i.Rf.success({staffRecords:m,pagination:{page:c,limit:u,totalCount:h,totalPages:Math.ceil(h/u)}})}catch(e){return(0,i.zG)(e)}}n=(a.then?(await a)():a)[0],s()}catch(e){s(e)}})},92606:(e,r,t)=>{t.d(r,{MH:()=>u,fT:()=>i,mk:()=>c});var s=t(41482),n=t.n(s);function o(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET environment variable is not set");return e}function i(e,r="7d"){return n().sign(e,o(),{expiresIn:r})}t(42023);let a=e=>{try{return n().verify(e,o())}catch{return null}},c=e=>{if(!e)throw Error("Authentication required");let r=a(e);if(!r)throw Error("Invalid or expired token");return r},u=(e,r)=>{let t=c(e);if(!r.includes(t.role))throw Error("Insufficient permissions");return t}},52850:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{_:()=>d});var n=t(53524),o=t(61574),i=t(8678),a=e([o,i]);[o,i]=a.then?(await a)():a;let c=globalThis,u=c.pool??new i.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}}),p=new o.PrismaPg(u),d=c.prisma??new n.PrismaClient({adapter:p,log:["query","error","warn"]});s()}catch(e){s(e)}})},7371:(e,r,t)=>{t.d(r,{Rf:()=>n,zG:()=>o});var s=t(87070);class n{static success(e,r="Success",t=200){return s.NextResponse.json({success:!0,message:r,data:e},{status:t})}static error(e="Error",r=400,t){return s.NextResponse.json({success:!1,message:e,errors:t||[]},{status:r})}static unauthorized(e="Unauthorized"){return this.error(e,401)}static forbidden(e="Forbidden"){return this.error(e,403)}static notFound(e="Resource not found"){return this.error(e,404)}static serverError(e="Internal server error"){return this.error(e,500)}}let o=e=>(console.error("API Error:",e),e instanceof Error)?n.error(e.message):n.serverError()}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[377,443,70],()=>t(85059));module.exports=s})();