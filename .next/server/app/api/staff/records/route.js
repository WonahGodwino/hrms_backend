"use strict";(()=>{var e={};e.id=948,e.ids=[948],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},61574:e=>{e.exports=import("@prisma/adapter-pg")},8678:e=>{e.exports=import("pg")},85059:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>u,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>p});var o=t(49303),s=t(88716),i=t(60670),a=t(10113),c=e([a]);a=(c.then?(await c)():c)[0];let d=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/staff/records/route",pathname:"/api/staff/records",filename:"route",bundlePath:"app/api/staff/records/route"},resolvedPagePath:"C:\\hrms-project\\src\\app\\api\\staff\\records\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:f}=d,h="/api/staff/records/route";function u(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:p})}n()}catch(e){n(e)}})},10113:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{GET:()=>d,OPTIONS:()=>u});var o=t(52850),s=t(92606),i=t(7371),a=t(27305),c=e([o]);async function u(e){return(0,a.Ak)(e)}async function d(e){let r=e.headers.get("origin");try{let t=e.headers.get("authorization");if(!t)return(0,a.o3)(i.Rf.error("Authorization header missing",401),r);let n=t.replace("Bearer ",""),c=(0,s.MH)(n,["HR","SUPER_ADMIN","MANAGER"]),{searchParams:u}=new URL(e.url),d=parseInt(u.get("page")||"1",10),l=parseInt(u.get("limit")||"50",10),p=u.get("department"),f=u.get("search"),h=(d-1)*l,m={};if("SUPER_ADMIN"!==c.role){if(!c.companyId)return(0,a.o3)(i.Rf.error("No company assigned for this user",400),r);m.companyId=c.companyId}p&&(m.department={contains:p,mode:"insensitive"}),f&&(m.OR=[{firstName:{contains:f,mode:"insensitive"}},{lastName:{contains:f,mode:"insensitive"}},{staffId:{contains:f,mode:"insensitive"}},{email:{contains:f,mode:"insensitive"}}]);let[g,A]=await Promise.all([o._.staffRecord.findMany({where:m,skip:h,take:l,orderBy:{createdAt:"desc"},select:{id:!0,staffId:!0,email:!0,firstName:!0,lastName:!0,department:!0,position:!0,phone:!0,isActive:!0,createdAt:!0,companyId:!0}}),o._.staffRecord.count({where:m})]);return(0,a.o3)(i.Rf.success({staffRecords:g,pagination:{page:d,limit:l,totalCount:A,totalPages:Math.ceil(A/l)}}),r)}catch(e){return(0,a.o3)((0,i.zG)(e),r)}}o=(c.then?(await c)():c)[0],n()}catch(e){n(e)}})},92606:(e,r,t)=>{t.d(r,{MH:()=>u,fT:()=>i,mk:()=>c});var n=t(41482),o=t.n(n);function s(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET environment variable is not set");return e}function i(e,r="7d"){return o().sign(e,s(),{expiresIn:r})}t(42023);let a=e=>{try{return o().verify(e,s())}catch{return null}},c=e=>{if(!e)throw Error("Authentication required");let r=a(e);if(!r)throw Error("Invalid or expired token");return r},u=(e,r)=>{let t=c(e);if(!r.includes(t.role))throw Error("Insufficient permissions");return t}},27305:(e,r,t)=>{t.d(r,{Ak:()=>i,o3:()=>s});var n=t(87070);let o=["http://localhost:5173","http://localhost:5173"].filter(Boolean);function s(e,r){return Object.entries(function(e){let r=e?o.includes(e)?e:void 0:o[0],t={"Access-Control-Allow-Methods":"GET,POST,PUT,PATCH,DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Access-Control-Allow-Credentials":"true"};return r&&(t["Access-Control-Allow-Origin"]=r),t}(r)).forEach(([r,t])=>{e.headers.set(r,t)}),e}function i(e){let r=e.headers.get("origin");return s(new n.NextResponse(null,{status:200}),r)}},52850:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.d(r,{_:()=>A});var o=t(53524),s=t(61574),i=t(8678),a=t(92048),c=t.n(a),u=t(55315),d=t.n(u),l=e([s,i]);[s,i]=l.then?(await l)():l;let p=globalThis,f=d().join(process.cwd(),"certs","aiven-ca.pem"),h=c().readFileSync(f,"utf8"),m=p.pool??new i.Pool({connectionString:process.env.DATABASE_URL,ssl:{ca:h,rejectUnauthorized:!1}}),g=new s.PrismaPg(m),A=p.prisma??new o.PrismaClient({adapter:g,log:["query","error","warn"]});n()}catch(e){n(e)}})},7371:(e,r,t)=>{t.d(r,{Rf:()=>o,Z:()=>s,zG:()=>i});var n=t(87070);class o{static success(e,r="Success",t=200){return n.NextResponse.json({success:!0,message:r,data:e},{status:t})}static error(e="Error",r=400,t){return n.NextResponse.json({success:!1,message:e,errors:t||[]},{status:r})}static unauthorized(e="Unauthorized"){return this.error(e,401)}static forbidden(e="Forbidden"){return this.error(e,403)}static notFound(e="Resource not found"){return this.error(e,404)}static serverError(e="Internal server error"){return this.error(e,500)}}function s(e){if(e instanceof Error)return e.message;if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return"An unexpected error occurred"}}let i=e=>{console.error("API Error:",e);let r=s(e);return o.error(r,500)}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[377,972,944],()=>t(85059));module.exports=n})();