"use strict";(()=>{var e={};e.id=228,e.ids=[228],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},61574:e=>{e.exports=import("@prisma/adapter-pg")},8678:e=>{e.exports=import("pg")},91082:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>c,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>f,staticGenerationAsyncStorage:()=>p});var s=t(49303),n=t(88716),a=t(60670),i=t(43834),u=e([i]);i=(u.then?(await u)():u)[0];let l=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/staff/upload/history/route",pathname:"/api/staff/upload/history",filename:"route",bundlePath:"app/api/staff/upload/history/route"},resolvedPagePath:"C:\\hrms-project\\src\\app\\api\\staff\\upload\\history\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:f}=l,h="/api/staff/upload/history/route";function c(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:p})}o()}catch(e){o(e)}})},43834:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{GET:()=>c});var s=t(52850),n=t(92606),a=t(7371),i=t(27305),u=e([s]);async function c(e){let r=e.headers.get("origin");try{let t=e.headers.get("authorization");if(!t)return(0,i.o3)(a.Rf.error("Authorization header missing",401),r);let o=t.replace("Bearer ",""),u=(0,n.MH)(o,["HR","SUPER_ADMIN"]);if(!u.companyId)return(0,i.o3)(a.Rf.error("No company context for this user",400),r);let c=u.companyId,l=await s._.staffUpload.findMany({where:{companyId:c},orderBy:{createdAt:"desc"},select:{id:!0,fileName:!0,createdAt:!0,uploadedBy:!0,failed:!0,successful:!0}});return(0,i.o3)(a.Rf.success({uploads:l.map(e=>({uploadId:e.id,fileName:e.fileName,uploadedOn:e.createdAt,uploadedBy:e.uploadedBy,failed:e.failed,successful:e.successful,totalRecords:e.successful+e.failed}))},"Staff upload records fetched successfully"),r)}catch(e){return(0,i.o3)((0,a.zG)(e),r)}}s=(u.then?(await u)():u)[0],o()}catch(e){o(e)}})},92606:(e,r,t)=>{t.d(r,{MH:()=>c,fT:()=>a,mk:()=>u});var o=t(41482),s=t.n(o);function n(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET environment variable is not set");return e}function a(e,r="7d"){return s().sign(e,n(),{expiresIn:r})}t(42023);let i=e=>{try{return s().verify(e,n())}catch{return null}},u=e=>{if(!e)throw Error("Authentication required");let r=i(e);if(!r)throw Error("Invalid or expired token");return r},c=(e,r)=>{let t=u(e);if(!r.includes(t.role))throw Error("Insufficient permissions");return t}},27305:(e,r,t)=>{t.d(r,{Ak:()=>a,o3:()=>n});var o=t(87070);let s=["http://localhost:5173","http://localhost:5173"].filter(Boolean);function n(e,r){return Object.entries(function(e){let r=e?s.includes(e)?e:void 0:s[0],t={"Access-Control-Allow-Methods":"GET,POST,PUT,PATCH,DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Access-Control-Allow-Credentials":"true"};return r&&(t["Access-Control-Allow-Origin"]=r),t}(r)).forEach(([r,t])=>{e.headers.set(r,t)}),e}function a(e){let r=e.headers.get("origin");return n(new o.NextResponse(null,{status:200}),r)}},52850:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.d(r,{_:()=>A});var s=t(53524),n=t(61574),a=t(8678),i=t(92048),u=t.n(i),c=t(55315),l=t.n(c),d=e([n,a]);[n,a]=d.then?(await d)():d;let p=globalThis,f=l().join(process.cwd(),"certs","aiven-ca.pem"),h=u().readFileSync(f,"utf8"),y=p.pool??new a.Pool({connectionString:process.env.DATABASE_URL,ssl:{ca:h,rejectUnauthorized:!1}}),m=new n.PrismaPg(y),A=p.prisma??new s.PrismaClient({adapter:m,log:["query","error","warn"]});o()}catch(e){o(e)}})},7371:(e,r,t)=>{t.d(r,{Rf:()=>s,Z:()=>n,zG:()=>a});var o=t(87070);class s{static success(e,r="Success",t=200){return o.NextResponse.json({success:!0,message:r,data:e},{status:t})}static error(e="Error",r=400,t){return o.NextResponse.json({success:!1,message:e,errors:t||[]},{status:r})}static unauthorized(e="Unauthorized"){return this.error(e,401)}static forbidden(e="Forbidden"){return this.error(e,403)}static notFound(e="Resource not found"){return this.error(e,404)}static serverError(e="Internal server error"){return this.error(e,500)}}function n(e){if(e instanceof Error)return e.message;if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return"An unexpected error occurred"}}let a=e=>{console.error("API Error:",e);let r=n(e);return s.error(r,500)}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[377,972,944],()=>t(91082));module.exports=o})();